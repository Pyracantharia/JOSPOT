<VirtualHost *:80>
    ServerName joatm.online
    ServerAlias www.joatm.online

    ServerAdmin webmaster@joatm.online
    DocumentRoot /var/www/html

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Redirection permanente de HTTP à HTTPS
    Redirect permanent / https://joatm.online/
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName joatm.online
        ServerAlias www.joatm.online

        ServerAdmin webmaster@joatm.online
        DocumentRoot /var/www/html

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on
        SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
        SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

        # Sécuriser les en-têtes HTTP
        Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
        Header always set X-Frame-Options DENY
        Header always set X-Content-Type-Options nosniff
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://maps.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https://maps.gstatic.com https://maps.googleapis.com https://tickets.paris2024.org; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; connect-src 'self' https://data.paris2024.org https://api.distancematrix.ai https://maps.googleapis.com"

        # Inclure des fichiers de configuration supplémentaires
        # Include conf-available/serve-cgi-bin.conf
    </VirtualHost>
</IfModule>
